<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reports - SuperMarket</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/admin.css">
</head>

<body>
    <div class="container-fluid">
        <div class="row vh-100">
            <!-- Sidebar -->
            <nav class="col-md-3 col-lg-2 d-md-block bg-dark sidebar collapse">
                <div class="position-sticky pt-3">
                    <div class="text-center mb-4">
                        <i class="fas fa-store fa-3x text-light"></i>
                        <h5 class="mt-2 text-light">SuperMarket Admin</h5>
                    </div>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="dashboard.html">
                                <i class="fas fa-tachometer-alt me-2"></i>
                                Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="products.html">
                                <i class="fas fa-box me-2"></i>
                                Products
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="inventory.html">
                                <i class="fas fa-warehouse me-2"></i>
                                Inventory
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="customers.html">
                                <i class="fas fa-users me-2"></i>
                                Customers
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="orders.html">
                                <i class="fas fa-clipboard-list me-2"></i>
                                Orders
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="vouchers.html">
                                <i class="fas fa-ticket-alt me-2"></i>
                                Vouchers
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="reports.html">
                                <i class="fas fa-chart-bar me-2"></i>
                                Reports
                            </a>
                        </li>
                        <li class="nav-item mt-5">
                            <a class="nav-link text-danger" href="#" id="logoutBtn">
                                <i class="fas fa-sign-out-alt me-2"></i>
                                Logout
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- Main Content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div
                    class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">Reports</h1>
                    <div class="btn-toolbar">
                        <button type="button" class="btn btn-outline-secondary me-2" id="printReportBtn">
                            <i class="fas fa-print me-2"></i> Print Current Report
                        </button>
                    </div>
                </div>

                <!-- Reports List -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="card shadow-sm h-100">
                            <div class="card-header bg-light">
                                <h5 class="mb-0">Available Reports</h5>
                            </div>
                            <div class="card-body p-0">
                                <div class="list-group list-group-flush" id="reportsListTab" role="tablist">
                                    <a class="list-group-item list-group-item-action active" id="needs-restock-tab"
                                        data-bs-toggle="tab" href="#needs-restock" role="tab"
                                        aria-controls="needs-restock">
                                        <i class="fas fa-exclamation-triangle me-2 text-warning"></i> Needs Restock
                                    </a>
                                    <a class="list-group-item list-group-item-action" id="never-bought-tab"
                                        data-bs-toggle="tab" href="#never-bought" role="tab"
                                        aria-controls="never-bought">
                                        <i class="fas fa-box me-2 text-secondary"></i> Never Bought Products
                                    </a>
                                    <a class="list-group-item list-group-item-action" id="most-bought-tab"
                                        data-bs-toggle="tab" href="#most-bought" role="tab"
                                        aria-controls="most-bought">
                                        <i class="fas fa-star me-2 text-primary"></i> Most Bought Products
                                    </a>
                                    <a class="list-group-item list-group-item-action" id="product-customers-tab"
                                        data-bs-toggle="tab" href="#product-customers" role="tab"
                                        aria-controls="product-customers">
                                        <i class="fas fa-users me-2 text-info"></i> Product Customers
                                    </a>
                                    <a class="list-group-item list-group-item-action" id="inactive-customers-tab"
                                        data-bs-toggle="tab" href="#inactive-customers" role="tab"
                                        aria-controls="inactive-customers">
                                        <i class="fas fa-user-clock me-2 text-danger"></i> Inactive Customers
                                    </a>
                                    <a class="list-group-item list-group-item-action" id="top-spender-tab"
                                        data-bs-toggle="tab" href="#top-spender" role="tab"
                                        aria-controls="top-spender">
                                        <i class="fas fa-crown me-2 text-warning"></i> Top Spenders
                                    </a>
                                    <a class="list-group-item list-group-item-action" id="category-comparison-tab"
                                        data-bs-toggle="tab" href="#category-comparison" role="tab"
                                        aria-controls="category-comparison">
                                        <i class="fas fa-balance-scale me-2 text-success"></i> Category Comparison
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-9">
                        <div class="tab-content" id="reportsTabContent">
                            <!-- Needs Restock Report -->
                            <div class="tab-pane fade show active" id="needs-restock" role="tabpanel"
                                aria-labelledby="needs-restock-tab">
                                <div class="card shadow-sm">
                                    <div class="card-header bg-light">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <h5 class="mb-0">Needs Restock Report</h5>
                                            <span class="badge bg-warning" id="needsRestockCount">0</span>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div id="needsRestockLoading" class="text-center py-4">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                            <p class="mt-2">Loading report data...</p>
                                        </div>
                                        <div id="needsRestockContent" class="d-none">
                                            <p class="text-muted">Products with inventory levels at or below the restock
                                                threshold.</p>
                                            <div class="table-responsive mt-3">
                                                <table class="table table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th>Product ID</th>
                                                            <th>Name</th>
                                                            <th>Category</th>
                                                            <th>Current Stock</th>
                                                            <th>Location</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="needsRestockTable">
                                                        <!-- Data will be loaded here by JavaScript -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        <div id="needsRestockEmpty" class="text-center py-4 d-none">
                                            <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
                                            <h5>No products need restocking</h5>
                                            <p>All products have adequate inventory levels</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Never Bought Products Report -->
                            <div class="tab-pane fade" id="never-bought" role="tabpanel"
                                aria-labelledby="never-bought-tab">
                                <div class="card shadow-sm">
                                    <div class="card-header bg-light">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <h5 class="mb-0">Never Bought Products Report</h5>
                                            <span class="badge bg-secondary" id="neverBoughtCount">0</span>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div id="neverBoughtLoading" class="text-center py-4">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                            <p class="mt-2">Loading report data...</p>
                                        </div>
                                        <div id="neverBoughtContent" class="d-none">
                                            <p class="text-muted">Products that have never been purchased by any
                                                customer.</p>
                                            <div class="table-responsive mt-3">
                                                <table class="table table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th>Product ID</th>
                                                            <th>Name</th>
                                                            <th>Category</th>
                                                            <th>Price</th>
                                                            <th>Current Stock</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="neverBoughtTable">
                                                        <!-- Data will be loaded here by JavaScript -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        <div id="neverBoughtEmpty" class="text-center py-4 d-none">
                                            <i class="fas fa-shopping-cart fa-3x text-success mb-3"></i>
                                            <h5>All products have been purchased</h5>
                                            <p>There are no products that have never been bought</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Most Bought Products Report -->
                            <div class="tab-pane fade" id="most-bought" role="tabpanel"
                                aria-labelledby="most-bought-tab">
                                <div class="card shadow-sm">
                                    <div class="card-header bg-light">
                                        <h5 class="mb-0">Most Bought Products Report</h5>
                                    </div>
                                    <div class="card-body">
                                        <div id="mostBoughtLoading" class="text-center py-4">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                            <p class="mt-2">Loading report data...</p>
                                        </div>
                                        <div id="mostBoughtContent" class="d-none">
                                            <p class="text-muted">Products ranked by total number of purchases.</p>
                                            <div class="row mb-4">
                                                <div class="col-md-8">
                                                    <canvas id="mostBoughtChart"></canvas>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="card bg-light">
                                                        <div class="card-body">
                                                            <h6 class="card-title">Top Product</h6>
                                                            <div id="topProductInfo">
                                                                <h4 id="topProductName">Product Name</h4>
                                                                <p class="mb-1">Purchases: <span
                                                                        id="topProductPurchases">0</span></p>
                                                                <p class="mb-1">Unique Customers: <span
                                                                        id="topProductCustomers">0</span></p>
                                                                <p class="mb-0">Price: $<span
                                                                        id="topProductPrice">0</span></p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="table-responsive">
                                                <table class="table table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th>Product ID</th>
                                                            <th>Name</th>
                                                            <th>Price</th>
                                                            <th>Purchase Count</th>
                                                            <th>Unique Customers</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="mostBoughtTable">
                                                        <!-- Data will be loaded here by JavaScript -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        <div id="mostBoughtEmpty" class="text-center py-4 d-none">
                                            <i class="fas fa-shopping-basket fa-3x text-muted mb-3"></i>
                                            <h5>No purchase data available</h5>
                                            <p>There are no product purchases recorded yet</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Product Customers Report -->
                            <div class="tab-pane fade" id="product-customers" role="tabpanel"
                                aria-labelledby="product-customers-tab">
                                <div class="card shadow-sm">
                                    <div class="card-header bg-light">
                                        <h5 class="mb-0">Product Customers Report</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row mb-4">
                                            <div class="col-md-6">
                                                <label for="productSelector" class="form-label">Select Product</label>
                                                <select class="form-select" id="productSelector">
                                                    <option value="">Choose a product...</option>
                                                    <!-- Products will be loaded here by JavaScript -->
                                                </select>
                                            </div>
                                            <div class="col-md-6 d-flex align-items-end">
                                                <button class="btn btn-primary" id="generateProductCustomersBtn">
                                                    <i class="fas fa-chart-pie me-2"></i> Generate Report
                                                </button>
                                            </div>
                                        </div>

                                        <div id="productCustomersLoading" class="text-center py-4 d-none">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                            <p class="mt-2">Loading report data...</p>
                                        </div>

                                        <div id="productCustomersContent" class="d-none">
                                            <div class="alert alert-info mb-4">
                                                <h6 class="alert-heading mb-1">Product Information</h6>
                                                <p class="mb-1"><strong>Name:</strong> <span
                                                        id="selectedProductName"></span></p>
                                                <p class="mb-0"><strong>ID:</strong> <span
                                                        id="selectedProductId"></span></p>
                                            </div>

                                            <h6>Customers who purchased this product:</h6>
                                            <div class="table-responsive mt-3">
                                                <table class="table table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th>Customer ID</th>
                                                            <th>Name</th>
                                                            <th>Email</th>
                                                            <th>Last Purchase</th>
                                                            <th>Order Count</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="productCustomersTable">
                                                        <!-- Data will be loaded here by JavaScript -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>

                                        <div id="productCustomersEmpty" class="text-center py-4 d-none">
                                            <i class="fas fa-users fa-3x text-muted mb-3"></i>
                                            <h5>No customers have purchased this product</h5>
                                            <p>This product has not been sold yet</p>
                                        </div>

                                        <div id="productCustomersSelect" class="text-center py-4">
                                            <i class="fas fa-hand-pointer fa-3x text-muted mb-3"></i>
                                            <h5>Please select a product</h5>
                                            <p>Choose a product from the dropdown to see customer data</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Inactive Customers Report -->
                            <div class="tab-pane fade" id="inactive-customers" role="tabpanel"
                                aria-labelledby="inactive-customers-tab">
                                <div class="card shadow-sm">
                                    <div class="card-header bg-light">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <h5 class="mb-0">Inactive Customers Report</h5>
                                            <span class="badge bg-danger" id="inactiveCustomersCount">0</span>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div id="inactiveCustomersLoading" class="text-center py-4">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                            <p class="mt-2">Loading report data...</p>
                                        </div>
                                        <div id="inactiveCustomersContent" class="d-none">
                                            <p class="text-muted">Customers who haven't placed an order in the last 3
                                                months or have never ordered.</p>
                                            <div class="table-responsive mt-3">
                                                <table class="table table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th>Customer ID</th>
                                                            <th>Name</th>
                                                            <th>Email</th>
                                                            <th>Last Order Date</th>
                                                            <th>Action</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="inactiveCustomersTable">
                                                        <!-- Data will be loaded here by JavaScript -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        <div id="inactiveCustomersEmpty" class="text-center py-4 d-none">
                                            <i class="fas fa-users-cog fa-3x text-success mb-3"></i>
                                            <h5>No inactive customers</h5>
                                            <p>All customers have placed orders in the last 3 months</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Top Spenders Report -->
                            <div class="tab-pane fade" id="top-spender" role="tabpanel"
                                aria-labelledby="top-spender-tab">
                                <div class="card shadow-sm">
                                    <div class="card-header bg-light">
                                        <h5 class="mb-0">Top Spenders Report</h5>
                                    </div>
                                    <div class="card-body">
                                        <div id="topSpendersLoading" class="text-center py-4">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                            <p class="mt-2">Loading report data...</p>
                                        </div>
                                        <div id="topSpendersContent" class="d-none">
                                            <p class="text-muted">Top 10 customers by total spend amount.</p>
                                            <div class="row mb-4">
                                                <div class="col-md-8">
                                                    <canvas id="topSpendersChart"></canvas>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="card bg-light">
                                                        <div class="card-body">
                                                            <h6 class="card-title">Top Spender</h6>
                                                            <div id="topSpenderInfo">
                                                                <h4 id="topSpenderName">Customer Name</h4>
                                                                <p class="mb-1">Total Spend: $<span
                                                                        id="topSpenderAmount">0</span></p>
                                                                <p class="mb-0">Orders: <span
                                                                        id="topSpenderOrders">0</span></p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="table-responsive">
                                                <table class="table table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th>Customer ID</th>
                                                            <th>Name</th>
                                                            <th>Email</th>
                                                            <th>Order Count</th>
                                                            <th>Total Spend</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="topSpendersTable">
                                                        <!-- Data will be loaded here by JavaScript -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        <div id="topSpendersEmpty" class="text-center py-4 d-none">
                                            <i class="fas fa-file-invoice-dollar fa-3x text-muted mb-3"></i>
                                            <h5>No spending data available</h5>
                                            <p>There are no completed orders yet</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Category Comparison Report -->
                            <div class="tab-pane fade" id="category-comparison" role="tabpanel"
                                aria-labelledby="category-comparison-tab">
                                <div class="card shadow-sm">
                                    <div class="card-header bg-light">
                                        <h5 class="mb-0">Category Sales Comparison</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row mb-4">
                                            <div class="col-md-5">
                                                <label for="category1Selector" class="form-label">First Category</label>
                                                <select class="form-select" id="category1Selector">
                                                    <option value="">Choose first category...</option>
                                                    <!-- Categories will be loaded here by JavaScript -->
                                                </select>
                                            </div>
                                            <div class="col-md-5">
                                                <label for="category2Selector" class="form-label">Second
                                                    Category</label>
                                                <select class="form-select" id="category2Selector">
                                                    <option value="">Choose second category...</option>
                                                    <!-- Categories will be loaded here by JavaScript -->
                                                </select>
                                            </div>
                                            <div class="col-md-2 d-flex align-items-end">
                                                <button class="btn btn-primary w-100" id="compareCategoriesBtn">
                                                    <i class="fas fa-balance-scale me-2"></i> Compare
                                                </button>
                                            </div>
                                        </div>

                                        <div id="categoryComparisonLoading" class="text-center py-4 d-none">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                            <p class="mt-2">Loading report data...</p>
                                        </div>

                                        <div id="categoryComparisonContent" class="d-none">
                                            <div class="row mb-4">
                                                <div class="col-md-6">
                                                    <canvas id="categorySalesChart"></canvas>
                                                </div>
                                                <div class="col-md-6">
                                                    <canvas id="categoryRevenueChart"></canvas>
                                                </div>
                                            </div>

                                            <h6>Sales Summary:</h6>
                                            <div class="table-responsive">
                                                <table class="table table-bordered">
                                                    <thead>
                                                        <tr>
                                                            <th>Category</th>
                                                            <th>Total Sales</th>
                                                            <th>Total Revenue</th>
                                                            <th>Product Count</th>
                                                            <th>Avg Sales Per Product</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="categorySummaryTable">
                                                        <!-- Data will be loaded here by JavaScript -->
                                                    </tbody>
                                                </table>
                                            </div>

                                            <h6 class="mt-4">Product Sales Details:</h6>
                                            <div class="table-responsive">
                                                <table class="table table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th>Category</th>
                                                            <th>Product ID</th>
                                                            <th>Product Name</th>
                                                            <th>Sales Count</th>
                                                            <th>Revenue</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="categoryDetailsTable">
                                                        <!-- Data will be loaded here by JavaScript -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>

                                        <div id="categoryComparisonEmpty" class="text-center py-4 d-none">
                                            <i class="fas fa-chart-line fa-3x text-muted mb-3"></i>
                                            <h5>No sales data available for comparison</h5>
                                            <p>There are no sales recorded for the selected categories</p>
                                        </div>

                                        <div id="categoryComparisonSelect" class="text-center py-4">
                                            <i class="fas fa-hand-pointer fa-3x text-muted mb-3"></i>
                                            <h5>Please select two categories to compare</h5>
                                            <p>Choose categories from the dropdowns above to see comparison data</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Email Voucher Modal -->
    <div class="modal fade" id="emailVoucherModal" tabindex="-1" aria-labelledby="emailVoucherModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="emailVoucherModalLabel">Send Voucher to Inactive Customer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="emailVoucherAlert" class="alert alert-danger d-none"></div>
                    <form id="emailVoucherForm">
                        <input type="hidden" id="emailVoucherCustomerId">
                        <div class="mb-3">
                            <label class="form-label">Customer</label>
                            <input type="text" class="form-control" id="emailVoucherCustomerName" readonly>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" id="emailVoucherCustomerEmail" readonly>
                        </div>
                        <div class="mb-3">
                            <label for="emailVoucherValue" class="form-label">Voucher Value</label>
                            <div class="input-group">
                                <span class="input-group-text">$</span>
                                <input type="number" class="form-control" id="emailVoucherValue" min="1" value="10"
                                    required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="emailVoucherExpiry" class="form-label">Expiry Date</label>
                            <input type="date" class="form-control" id="emailVoucherExpiry" required>
                        </div>
                        <div class="form-text">
                            <i class="fas fa-info-circle me-1"></i> This will create a new voucher and assign it to the
                            customer.
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="sendVoucherBtn">Create & Assign Voucher</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../js/Admin/reports.js"></script>
</body>

</html>